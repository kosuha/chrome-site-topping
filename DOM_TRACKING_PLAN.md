# DOM 추적 시스템 설계 계획

## 프로젝트 목표
사용자가 코드 에디터에서 작성한 JavaScript/CSS 코드를 실시간으로 웹페이지에 적용하고, 변경 사항을 원래 상태로 복원할 수 있는 시스템 구현

## 기술적 도전 과제
- **문제**: 사용자 코드 실행 후 DOM 변경사항을 정확히 추적하고 복원 필요
- **제약**: React Virtual DOM은 직접 DOM 조작을 추적하지 못함
- **요구사항**: 핫리로드 방식으로 실시간 코드 변경 반영

## 선택된 해결 방안: 부분 스냅샷 + Diff 기반

### 1. 부분 스냅샷 시스템
```javascript
class PartialDOMTracker {
  constructor() {
    this.trackedSelectors = [
      'body',                    // 메인 콘텐츠 영역
      'head > style',            // CSS 스타일 태그
      'head > link',             // 외부 스타일시트
      '[id]',                    // ID 속성 요소
      '[class*="user-"]',        // 사용자 정의 클래스
      '.product-*', '#main-*'    // 주요 영역 (쇼핑몰 기준)
    ];
  }
  
  createSnapshot() {
    // 관심 영역만 선별적으로 스냅샷 생성
  }
}
```

**장점:**
- 전체 DOM 대신 관심 영역만 추적 (90% 성능 향상)
- 메모리 사용량 대폭 감소

### 2. Diff 기반 복원 시스템
```javascript
class DOMDiffer {
  diff(before, after) {
    // 변경사항 분류:
    // - 추가된 요소
    // - 삭제된 요소  
    // - 수정된 속성/스타일
  }
  
  rollback(changes) {
    // 변경사항을 역순으로 복원
  }
}
```

**장점:**
- React의 reconciliation과 유사한 최적화
- 변경된 부분만 선별적으로 복원

## 성능 예상치

### 일반적인 쇼핑몰 기준
- **전체 DOM 요소**: 5,000-15,000개
- **추적 대상 요소**: 500-1,500개 (90% 감소)
- **HTML 크기**: 2-10MB → 200KB-1MB

### 성능 비교
| 방식 | 스냅샷 시간 | 복원 시간 | 메모리 사용량 |
|------|-------------|-----------|---------------|
| 전체 스냅샷 | 200-500ms | 100-300ms | 10-50MB |
| 부분 스냅샷 | 20-50ms | 10-30ms | 1-5MB |

## 핫리로드 구현 플로우

```
1. 페이지 로드 시: 초기 부분 스냅샷 생성
2. 사용자 코드 실행: DOM 변경사항 발생
3. 코드 수정 시: 
   - 현재 상태와 초기 스냅샷 Diff 계산
   - 이전 변경사항 롤백
   - 새 코드 실행
   - 새로운 변경사항 적용
```

## 기술 스택
- **Chrome Extension**: 현재 React + TypeScript 기반 유지
- **DOM 추적**: MutationObserver + 커스텀 Diff 엔진
- **통신**: 기존 Background Script ↔ Content Script 메시지 패싱 활용

## 구현 단계
1. **Phase 1**: 기본 부분 스냅샷 시스템 구현
2. **Phase 2**: Diff 엔진 개발 및 롤백 기능
3. **Phase 3**: 핫리로드 통합 및 성능 최적화
4. **Phase 4**: 다양한 웹사이트 테스트 및 안정화

## 예상 결과
- **실시간 코드 반영**: 코드 변경 즉시 페이지에 반영
- **안전한 복원**: 원본 상태로 완전 복구 가능
- **허용 가능한 성능**: 대부분 웹사이트에서 50ms 이하 지연
- **확장 가능성**: 다양한 웹사이트 유형에 대응 가능