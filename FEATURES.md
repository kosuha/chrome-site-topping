# Site Topping 기능 설명서

Site Topping은 사용자의 웹사이트에 JavaScript/CSS 코드를 실시간으로 작성, 미리보기, 배포할 수 있는 크롬 확장프로그램입니다. 사용자가 자신의 사이트에 연동 스크립트를 삽입하면, 확장프로그램에서 작성한 코드가 서버를 통해 실시간으로 사이트에 적용됩니다.

## 서비스 아키텍처

### 기본 연동 방식
1. **스크립트 삽입**: 사용자가 자신의 웹사이트에 연동 스크립트 삽입
2. **URL 요청**: 삽입된 스크립트가 서버에 JS/CSS 코드를 요청
3. **코드 전달**: 서버에서 배포된 코드를 사이트로 전달하여 적용

### 실시간 미리보기 방식
- **원리**: 본래 익스텐션에서 직접 코드 주입하는 로컬 기능
- **제약 해결**: CSP(Content Security Policy) 등의 제한으로 인해 서버 경유 방식 사용
- **동작 과정**: 
  1. 미리보기 토글 활성화 시 편집 중인 코드가 서버로 전송
  2. 미리 삽입된 스크립트가 서버에서 "현재 편집 중인 임시 코드" 요청
  3. 서버에서 편집 중인 코드를 실시간으로 사이트에 전달

## 패널 헤더 기능

### 주요 컨트롤
- **미리보기 토글**: 실시간 코드 미리보기 활성화/비활성화
- **배포 버튼**: 현재 작업 상태를 실제 사이트에 배포
- **되돌리기 버튼**: 마지막 배포 상태로 복원

## 탭별 기능

### 1. 📝 코드 편집 탭 (CodeEditTab)
선택된 파일의 JavaScript와 CSS를 편집하는 핵심 기능입니다.

**주요 기능:**
- **언어 전환**: JavaScript/CSS 토글을 통한 언어 전환
- **파일 구조**: 각 파일은 JS와 CSS를 세트로 포함
- **파일 관리**: 
  - 선택된 파일명 수정 가능
  - 파일 버전 선택 및 편집
  - 새 파일 생성 기능
- **버전 관리**:
  - 저장 시 자동으로 버전 +1 생성
  - 대표 버전 설정 기능
- **파일 적용 설정**: 현재 파일을 사이트에 적용할지 토글로 설정
- **실시간 편집**: CodeMirror 에디터를 통한 구문 강조 및 자동완성

### 2. 🤖 AI 채팅 탭 (ChatTab)
AI를 통한 코드 수정 및 개선 기능입니다.

**핵심 특징:**
- **상태 공유**: 코드 편집 탭과 동일한 파일/코드 상태 공유
- **AI 기반 편집**: 사용자가 직접 코드를 수정하는 대신 AI를 통해 코드 수정
- **동일한 기능**: 코드 편집 탭의 모든 기능 포함 (파일 관리, 버전 관리, 적용 설정 등)
- **차별화된 인터페이스**: AI와의 대화를 통한 코드 작업 진행

**주요 기능:**
- AI 어시스턴트와의 실시간 대화
- 코드 리뷰 및 개선 제안
- 자연어 명령을 통한 코드 수정

### 3. 📁 파일 목록 탭 (FileListTab)
전체 파일 관리 및 배포 설정을 담당합니다.

**주요 기능:**
- **파일 목록 관리**: 생성된 모든 파일의 리스트 표시
- **배포 상태 관리**: 
  - 초기 로딩 시 마지막 배포 상태로 설정
  - 파일별 사이트 적용 여부 토글 설정
- **버전 관리**:
  - 파일별 버전 목록 표시
  - 대표 버전 설정 기능
  - 특정 버전 선택하여 다른 탭으로 이동
- **탭 간 연동**: 
  - 특정 버전 선택 시 해당 코드로 코드 편집 탭 또는 AI 채팅 탭 이동
  - 선택된 버전의 코드가 자동으로 열림
- **파일 정보**: 생성일, 수정일, 현재 사용 버전 표시

### 4. 👤 사용자 탭 (UserTab)
사용자 인증 및 계정 관리 기능입니다.

**로그인 전:**
- **OAuth 로그인**: Google, Kakao 계정을 통한 간편 로그인
- **에러 처리**: 로그인 실패 시 에러 메시지 표시
- **로딩 상태**: 인증 처리 중 로딩 표시

**로그인 후:**
- **사용자 정보 표시**: 이메일, 프로필 이미지
- **로그아웃**: 안전한 로그아웃 기능

## 핵심 워크플로우

### 1. 개발 워크플로우
1. 새 파일 생성 또는 기존 파일 선택
2. 코드 편집 탭 또는 AI 채팅 탭에서 JS/CSS 코드 작성/수정
3. 미리보기 토글 활성화로 실시간 미리보기 확인
4. 저장하여 새 버전 생성
5. 파일 목록 탭에서 적용할 파일들 선택
6. 배포 버튼으로 실제 사이트에 적용

### 2. 버전 관리 워크플로우
1. 기존 파일의 특정 버전 선택
2. 해당 버전 코드로 편집 작업 진행
3. 대표 버전 변경 또는 새 버전 생성
4. 파일별 적용 상태 관리

### 3. 실시간 미리보기 시스템
1. 미리보기 토글 활성화
2. 코드 변경 시 편집 중인 임시 코드를 서버로 전송
3. 사이트의 연동 스크립트가 서버에서 임시 코드를 받아와 적용
4. 사이트에서 즉시 변경사항 확인 (배포 전 테스트)

### 4. 배포 및 연동 시스템
1. 배포 버튼 클릭으로 현재 상태를 확정
2. 서버에 배포된 코드 상태 업데이트
3. 사이트의 연동 스크립트가 서버에서 배포된 코드를 받아와 적용
4. 실제 사이트에서 배포된 코드로 운영